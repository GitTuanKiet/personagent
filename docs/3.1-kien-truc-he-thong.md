## 3.1. Kiến trúc hệ thống và phương pháp phát triển

---

### 3.1.1. Từ ý tưởng đến quyết định kiến trúc

Sau khi hoàn thành việc khảo sát lý thuyết và lựa chọn công nghệ ở chương 2, giai đoạn triển khai đặt ra những thử thách thực tế cụ thể. Khác với việc xây dựng ứng dụng web thông thường, PersonAgent yêu cầu tích hợp chặt chẽ giữa suy luận AI, tự động hóa trình duyệt, và quản lý trạng thái thời gian thực trong một luồng công việc phức tạp.

#### **Thách thức kiến trúc chính:**

1. **Đồng bộ hóa trạng thái**: Tác nhân cần duy trì trạng thái nhất quán giữa vòng lặp suy luận AI và trạng thái phiên trình duyệt
2. **Khôi phục lỗi**: Tương tác trình duyệt có thể thất bại không thể đoán trước, cần cơ chế thử lại mạnh mẽ  
3. **Hiệu năng và độ chính xác**: Cân bằng giữa thời gian phản hồi và chất lượng suy luận
4. **Ràng buộc mở rộng**: Mỗi phiên tác nhân cần quy trình trình duyệt riêng biệt

#### **Quyết định kiến trúc và đánh đổi:**

Quyết định sử dụng **nền tảng LangGraph** làm bộ máy điều phối chính mang lại lợi ích đáng kể về tốc độ phát triển nhưng cũng tạo ra các phụ thuộc. Thay vì 3-4 tháng xây dựng hệ thống phụ trợ tùy chỉnh với hàng đợi thông điệp, quản lý trạng thái, và lớp giao diện lập trình, toàn bộ nỗ lực được chuyển hướng vào logic AI cốt lõi và tích hợp trình duyệt.

**Đánh đổi chính:** phụ thuộc vào hệ sinh thái LangGraph, nhưng lợi ích về thời gian đưa ra thị trường và khả năng mở rộng có sẵn vượt trội hơn rủi ro cho giai đoạn mẫu thử.

### 3.1.2. Kiến trúc đa kho: Tổ chức để mở rộng

Dự án được tổ chức theo mô hình **Turborepo đa kho** với cấu trúc rõ ràng:

#### **Ứng dụng chính (Apps):**
- `apps/agent/`: Trái tim của hệ thống - nơi chứa toàn bộ logic tác nhân AI
- `apps/web/`: Giao diện web cho người dùng tương tác

#### **Thư viện dùng chung (Packages):**  
- `packages/@pag/`: Các tiện ích và cấu hình được chia sẻ
- `packages/ui/`: Hệ thống thiết kế và các thành phần giao diện

**Lý do lựa chọn:** Tính mô-đun - mỗi thành phần có thể phát triển độc lập nhưng vẫn chia sẻ mã nguồn hiệu quả. Quan trọng hơn, khi dự án phát triển lớn hơn, có thể dễ dàng thêm các ứng dụng mới (ví dụ ứng dụng di động, bảng quản trị) mà không ảnh hưởng đến mã nguồn hiện tại.

### 3.1.3. Phương pháp phát triển: Từ lõi ra ngoại vi

Dựa trên kinh nghiệm các dự án trước, phương pháp **"Phát triển lõi trước"** được áp dụng:

1. **Tuần 1-2**: Xây dựng lõi tác nhân AI và bộ máy tương tác trình duyệt
2. **Tuần 3-4**: Phát triển bộ máy mô phỏng và hệ thống ghi nhật ký  
3. **Tuần 5-6**: Xây dựng giao diện người dùng và bảng điều khiển báo cáo
4. **Tuần 7**: Kiểm thử tích hợp và đóng gói ứng dụng

Cách tiếp cận này cho phép có được "bằng chứng về khái niệm" sớm - chỉ cần tác nhân AI hoạt động được với trình duyệt thì toàn bộ khái niệm đã được xác thực.

### 3.1.4. Công nghệ được sử dụng

#### **Hệ thống tác nhân AI:**
- **LangGraph 0.3.0**: Điều phối tác nhân dựa trên đồ thị
- **LangChain 0.3.27**: Tích hợp mô hình ngôn ngữ lớn và công cụ
- **Anthropic Claude**: Mô hình suy luận chính
- **Patchright 1.52.5**: Tự động hóa trình duyệt (nhánh của Playwright)

#### **Giao diện và hệ thống phụ trợ:**
- **Next.js 15**: Bộ định tuyến ứng dụng React với các thành phần máy chủ
- **React 19**: Phiên bản mới nhất với tính năng đồng thời
- **SDK LangGraph**: Tích hợp trực tiếp với giao diện lập trình tác nhân
- **Giao diện trợ lý**: Giao diện trò chuyện cho tương tác tác nhân

#### **Cơ sở dữ liệu và lưu trữ:**
- **PostgreSQL 17.5**: Cơ sở dữ liệu chính
- **Drizzle ORM 0.44.2**: Thao tác cơ sở dữ liệu an toàn kiểu
- **Redis 8.2**: Bộ nhớ đệm và lưu trữ phiên

#### **Phát triển và vận hành:**
- **Bun 1.2.17**: Trình quản lý gói và môi trường chạy
- **Turborepo 2.5.4**: Hệ thống xây dựng đa kho
- **Docker Compose**: Triển khai đa dịch vụ
- **TypeScript 5.8.3**: Đảm bảo an toàn kiểu dữ liệu 